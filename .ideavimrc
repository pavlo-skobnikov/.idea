" -> https://github.com/JetBrains/ideavim/wiki
""""" OPTIONS

" Use Vim as default handling for (almost) Vim shortcuts
sethandler a:vim
sethandler <C-y> a:ide

" Use Intellij's line joining behaviour
set ideajoin

" <SPC> as the leader key
let mapleader = " "

" Show Current Vim Mode
set showmode

" Use the Clipboard Register '*' for All Yank, Delete, Change and Put Operations
" (-> which would normally go to the unnamed register)
set clipboard+=unnamed

" Search as Characters are Entered
set incsearch

" Highlight Search Results
set hlsearch

" Case-sensitive Search Only on Present Upper Letters
set ignorecase
set smartcase

" Relative Numbers Only Club
set relativenumber

""""" PLUGINS & RELATED SETTINGS

"" PLUGIN
" Enable which-key extension
set which-key

" Disable which-key timeout, i.e. show the menu until you press a key
set notimeout

" Show the menu also for default Vim actions like `gg` or `zz`.
let g:WhichKey_ShowVimActions = "false"

"" PLUGIN
" Vim Movement in the Project View
" -> https://github.com/JetBrains/ideavim/wiki/NERDTree-support
set NERDTree

"" PLUGIN
" Emulate vim-surround. Commands: ys, cs, ds
" -> https://github.com/tpope/vim-surround/blob/master/doc/surround.txt
set surround

"" PLUGIN

" Add text object for arguments: aA (around arguments), iA (inside arguments)
set argtextobj

""""" MAPPINGS

" Increase/decrease selection
vnoremap ; :action EditorSelectWord<CR>
vnoremap , :action EditorUnSelectWord<CR>

" Easy window navigation
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Center screen on movement
nnoremap <C-d> <C-d>zz
nnoremap <C-u> <C-u>zz

" Replace multiple successive whitespaces with a single space
let g:WhichKeyDesc_TrimWhitespaceDelete = "di<SPACE> Trim whitespace"
nnoremap di<SPACE> f<SPACE>diwi<SPACE><ESC>

let g:WhichKeyDesc_TrimWhitespaceChange = "ci<SPACE> Trim whitespace"
vnoremap ci<SPACE> f<SPACE>diwi<SPACE>

" Remove highlights on <ESC>
nnoremap <ESC> :noh<CR>

" Open Explorer
nnoremap - :action SelectInProjectView<CR>
vnoremap - :action SelectInProjectView<CR>

"" Comment mappings
let g:WhichKeyDesc_CommentByBlockComment = "gb Comment by Block Comment"
nnoremap gb :action CommentByBlockComment<CR>
vnoremap gb :action CommentByBlockComment<CR>

let g:WhichKeyDesc_CommentByLineComment = "gc Comment by Line Comment"
nnoremap gc :action CommentByLineComment<CR>
vnoremap gc :action CommentByLineComment<CR>

""" Movement mappings
let g:WhichKeyDesc_GotoPreviousBookmark = "[h Previous mark"
nnoremap [h :action GotoPreviousBookmark<CR>

let g:WhichKeyDesc_GotoNextBookmark = "]h Next mark"
nnoremap ]h :action GotoNextBookmark<CR>

let g:WhichKeyDesc_MethodUp = "[f Previous Function"
nnoremap [f :action MethodUp<CR>

let g:WhichKeyDesc_MethodDown = "]f Next Function"
nnoremap ]f :action MethodDown<CR>

"" <leader> MAPPINGS
let g:WhichKeyDesc_ReformatCode = "<leader>= Reformat Code"
nnoremap <leader>= :action ReformatCode<CR>
vnoremap <leader>= :action ReformatCode<CR>

let g:WhichKeyDesc_HideAllWindows - "<leader>- Hide All Tool Windows"
nnoremap <leader>- :action HideAllWindows<CR>

let g:WhichKeyDesc_RecentLocations = "<leader>l Recent Location"
nnoremap <leader>l :action RecentLocations<CR>
vnoremap <leader>l :action RecentLocations<CR>

"" LSP Shared
" Get Minimal Parameter Info
nnoremap <C-S-k> :action ParameterInfo<CR>
inoremap <C-S-k> :action ParameterInfo<CR>

" Next/Previous Diagnostic
let g:WhichKeyDesc_GotoNextError = "]d Next diagnostic"
nnoremap ]d :action GotoNextError<CR>

let g:WhichKeyDesc_GotoPreviousError = "[d Previous diagnostic"
nnoremap [d :action GotoPreviousError<CR>

" Go to LSP capability actions
let g:WhichKeyDesc_GotoImplementation = "gi Go to implementation"
nnoremap gi :action GotoImplementation<CR>

let g:WhichKeyDesc_CallHierarchy = "gI Search incoming calls"
nnoremap gI :action CallHierarchy<CR>

let g:WhichKeyDesc_GotoSuperMethod = "go Go to super"
nnoremap go :action GotoSuperMethod<CR>

let g:WhichKeyDesc_GotoTypeDeclaration = "gt Go to type definition"
nnoremap gt :action GotoTypeDeclaration<CR>

let g:WhichKeyDesc_FindUsages = "gr Search references"
nnoremap gr :action FindUsages<CR>

" Intellij-specific go to LSP capability actions
let g:WhichKeyDesc_GotoTest = "gT Go to Test/Implementation"
nnoremap gT :action GotoTest<CR>

let g:WhichKeyDesc_GotoClass = "gC Go to Class"
nnoremap gC :action GotoClass<CR>

" Refactor actions
let g:WhichKeyDesc_Refactor = "<leader>r +refactor"

let g:WhichKeyDesc_ShowErrorDescription = "<leader>rf Open diagnostics float"
nnoremap <leader>rf :action ShowErrorDescription<CR>

let g:WhichKeyDesc_Refactorings_QuickListPopupAction= = "<leader>rl Code lens"
nnoremap <leader>rl :action Refactorings.QuickListPopupAction<CR>

let g:WhichKeyDesc_ActivateProblemsViewToolWindow = "<leader>rs Show diagnostics"
nnoremap <leader>rs :action ActivateProblemsViewToolWindow<CR>

let g:WhichKeyDesc_ShowIntentionActions = "<leader>ra Actions"
nnoremap <leader>ra :action ShowIntentionActions<CR>

let g:WhichKeyDesc_RenameElement = "<leader>rn Rename"
nnoremap <leader>rn :action RenameElement<CR>

let g:WhichKeyDesc_HighlightUsagesInFile = "<leader>rs Highlight symbol"
nnoremap <leader>rh :action HighlightUsagesInFile<CR>

let g:WhichKeyDesc_FileStructurePopup = "<leader>rd Search document symbols"
nnoremap <leader>rd :action FileStructurePopup<CR>

let g:WhichKeyDesc_GotoSymbol = "<leader>rw Search workspace symbols"
nnoremap <leader>rw :action GotoSymbol<CR>

" Intellij-specific refactor actions
let g:WhichKeyDesc_NewElement = "<leader>rc Create a new element"
nnoremap <leader>rc :action NewElement<CR>

let g:WhichKeyDesc_CodeCleanup = "<leader>rC Clean code up"
nnoremap <leader>rC :action CodeCleanup<CR>

let g:WhichKeyDesc_RenameFile = "<leader>rF Rename file"
nnoremap <leader>rF :action RenameFile<CR>

let g:WhichKeyDesc_Generate = "<leader>rg Generate"
nnoremap <leader>rg :action Generate<CR>

let g:WhichKeyDesc_TypeHierarchy = "<leader>rh Inheritance hierarchy"
nnoremap <leader>rh :action TypeHierarchy<CR>

let g:WhichKeyDesc_OptimizeImports = "<leader>ro Organize imports"
nnoremap <leader>ro :action OptimizeImports<CR>

let g:WhichKeyDesc_ReplaceInPath = "<leader>rp Replace in project"
nnoremap <leader>rp :action ReplaceInPath<CR>

let g:WhichKeyDesc_InspectCode = "<leader>ri Inspect Code"
nnoremap <leader>ri :action InspectCode<CR>

"" Completion
let g:WhichKeyDesc_CopilotChatShow = "<leader>c Show Copilot chat"
nnoremap <LEADER>c :action copilot.chat.show<CR>

let g:WhichKeyDesc_EnableCopilot = "yoc Enable Copilot"
nnoremap yoc :action copilot.enableCopilot<CR>

let g:WhichKeyDesc_DisableCopilot = "yoC Disable Copilot"
nnoremap yoC :action copilot.disableCopilot<CR>

"" Debug
let g:WhichKeyDesc_Debug = "<leader>d +debug"

let g:WhichKeyDesc_ActivateDebugToolWindow = "<leader>dD DAP UI"
nnoremap <leader>dD :action ActivateDebugToolWindow<CR>

let g:WhichKeyDesc_KotlinConsoleREPL = "<leader>dD Open REPL"
nnoremap <leader>dD :action KotlinConsoleREPL<CR>

let g:WhichKeyDesc_Continue = "<leader>dC Continue"
nnoremap <leader>dC :action Debug<CR>

let g:WhichKeyDesc_Debug_Run = "<leader>dR +run"

let g:WhichKeyDesc_Run = "<leader>dRr Run Current Configuration"
nnoremap <leader>dRr :action Run<CR>

" Run mappings
let g:WhichKeyDesc_RunAnything = "<leader>dRa Run anything"
nnoremap <leader>dRa :action RunAnything<CR>

let g:WhichKeyDesc_RunClass = "<leader>dRc Run under cursor"
nnoremap <leader>dRc :action RunClass<CR>

let g:WhichKeyDesc_Stop = "<leader>dRk Stop application"
nnoremap <leader>dRk :action Stop<CR>

let g:WhichKeyDesc_RerunTests = "<leader>dRt Re-run tests"
nnoremap <leader>dRt :action RerunTests<CR>

let g:WhichKeyDesc_ChooseRunConfiguration = "<leader>dRs Select configuration and run"
nnoremap <leader>dRs :action ChooseRunConfiguration<CR>

" Step mappings
let g:WhichKeyDesc_StepOver = "<leader>dn Step next"
nnoremap <leader>dn :action StepOver<CR>

let g:WhichKeyDesc_StepInto = "<leader>di Step into"
nnoremap <leader>di :action StepInto<CR>

let g:WhichKeyDesc_StepOut = "<leader>do Step out"
nnoremap <leader>do :action StepOut<CR>

" Breakpoint mappings
let g:WhichKeyDesc_AddBreakpoint = "<leader>db Toggle breakpoint"
nnoremap <leader>db :action AddBreakpoint<CR>

let g:WhichKeyDesc_AddConditionalBreakpoint = "<leader>dc Toggle conditional breakpoint"
nnoremap <leader>dc :action AddConditionalBreakpoint<CR>

let g:WhichKeyDesc_RemoveAllBreakpointsInFile = "<leader>dB Remove all breakpoints"
nnoremap <leader>dB :action Debugger.RemoveAllBreakpointsInFile<CR>

" Find mappings
let g:WhichKeyDesc_Debug_Find = "<leader>df +find"

let g:WhichKeyDesc_ViewBreakpoints = "<leader>dfb Breakpoints"
nnoremap <leader>dfb :action ViewBreakpoints<CR>

"" FIND
let g:WhichKeyDesc_Find = "<leader>f +find"

let g:WhichKeyDesc_GotoAction = "<leader>fc Command && run"
nnoremap <leader>fc :action GotoAction<CR>

let g:WhichKeyDesc_GotoFile = "<leader>ff Find files"
nnoremap <leader>ff :action GotoFile<CR>

let g:WhichKeyDesc_RecentFiles = "<leader>fF Recent files"
nnoremap <leader>fF :action RecentFiles<CR>

let g:WhichKeyDesc_FindInPath = "<leader>fg grep search"
nnoremap <leader>fg :action FindInPath<CR>

let g:WhichKeyDesc_ShowKeyBindings = "<leader>fk Keymaps"
nnoremap <leader>fk :map<CR>

let g:WhichKeyDesc_ShowBookmarks = "<leader>fb Bookmarks"
nnoremap <leader>fb :action ShowBookmarks<CR>

"" Git
let g:WhichKeyDesc_Annotate = "yob Toggle Blame"
nnoremap yob :action Annotate<CR>

let g:WhichKeyDesc_Git = "<leader>g +git"

let g:WhichKeyDesc_Git_Branches = "<leader>gb Branches"
nnoremap <leader>gb :action Git.Branches<CR>

let g:WhichKeyDesc_Vcs_Show_Local_Changes = "<leader>gg Changes"
nnoremap <leader>gg :action Vcs.Show.Local.Changes<CR>

let g:WhichKeyDesc_Vcs_QuickListPopupAction = "<leader>ga Actions"
nnoremap <leader>ga :action Vcs.QuickListPopupAction<CR>

let g:WhichKeyDesc_Vcs_Show_Log = "<leader>gl Log"
nnoremap <leader>gl :action Vcs.Show.Log<CR>

let g:WhichKeyDesc_Vcs_ShowTabbedFileHistory = "<leader>gh File history"
nnoremap <leader>gh :action Vcs.ShowTabbedFileHistory<CR>

let g:WhichKeyDesc_Vcs_Show_Shelf = "<leader>gs Stash"
nnoremap <leader>gs :action Vcs.Show.Shelf<CR>

let g:WhichKeyDesc_Vcs_Push = "<leader>gp Push"
nnoremap <leader>gp :action Vcs.Push<cr>

let g:WhichKeyDesc_Vcs_UpdateProject = "<leader>gu Pull"
nnoremap <leader>gu :action Vcs.UpdateProject<CR>

"" Hunks
let g:WhichKeyDesc_RightSquareBracket_VcsShowNextChangeMarker = "]g Next git change"
nnoremap ]g :action VcsShowNextChangeMarker<CR>

let g:WhichKeyDesc_LeftSquareBracket_VcsShowPrevChangeMarker = "[g Previous git change"
nnoremap [g :action VcsShowPrevChangeMarker<CR>

let g:WhichKeyDesc_Hunks = "<leader>h +hunks"

let g:WhichKeyDesc_Hunks_RollbackChangedLines = "<leader>hr Reset hunk"
nnoremap <leader>hr :action Vcs.RollbackChangedLines<CR>
vnoremap <leader>hr :action Vcs.RollbackChangedLines<CR>

"" Help
let g:WhichKeyDesc_Help = "<leader>H +help"

let g:WhichKeyDesc_Help_InspectionSettings = "<leader>Hi Open inspection settings"
nnoremap <leader>Hi :action PopupHector<CR>

let g:WhichKeyDesc_WelcomeScreen_DevelopPlugins = "<leader>Hp JetBrains plugins repository"
nnoremap <leader>Hp    :action WelcomeScreen.DevelopPlugins<CR>

let g:WhichKeyDesc_ReloadIdeaVimRc = "<leader>Hr Reload .ideavimrc"
nnoremap <leader>Hr    :source ~/.ideavimrc<CR>

"" Workspaces
let g:WhichKeyDesc_Workspaces = "<leader>w +workspaces"

let g:WhichKeyDesc_NextProjectWindow = "<leader>wn Focus next project"
nnoremap <leader>wn :action NextProjectWindow<CR>

let g:WhichKeyDesc_PreviousProjectWindow = "<leader>wp Focus previous project"
nnoremap <leader>wp :action PreviousProjectWindow<CR>

let g:WhichKeyDesc_InvalidateCaches = "<leader>wi Invalidate cache"
nnoremap <leader>wi :action InvalidateCaches<CR>

let g:WhichKeyDesc_ManageRecentProjects = "<leader>wr Recent projects"
nnoremap <leader>wr :action ManageRecentProjects<CR>

let g:WhichKeyDesc_NewProject = "<leader>wA Create new project"
nnoremap <leader>wA :action NewProject<CR>

let g:WhichKeyDesc_ImportProject = "<leader>wI Import project from existing files"
nnoremap <leader>wI :action ImportProject<CR>

let g:WhichKeyDesc_ProjectFromVersionControl = "<leader>wG New project from VCS"
nnoremap <leader>wG :action ProjectFromVersionControl<CR>

let g:WhichKeyDesc_CloseOtherProjects = "<leader>wO Close all other projects"
nnoremap <leader>wO :action CloseOtherProjects<CR>

let g:WhichKeyDesc_CloseProject = "<leader>wq Close this project"
nnoremap <leader>wq :action CloseProject<CR>

let g:WhichKeyDesc_CloseAllProjects = "<leader>wQ Close all projects"
nnoremap <leader>wQ :action CloseAllProjects<CR>

let g:WhichKeyDesc_Exit = "<leader>wE Exit"
nnoremap <leader>wE :action Exit<CR>

let g:WhichKeyDesc_RestartIde = "<leader>wR Restart"
nnoremap <leader>wR :action RestartIde<CR>

"" TOGGLE
let g:WhichKeyDesc_Toggles = "yo +toggle"

let g:WhichKeyDesc_EditorToggleShowIndentLines = "<yoi Toggle show indent guide"
nnoremap <yoi :action EditorToggleShowIndentLines<CR>

let g:WhichKeyDesc_EditorToggleUseSoftWraps = "<yow Toggle line wrapping"
nnoremap <yow :action EditorToggleUseSoftWraps<CR>

let g:WhichKeyDesc_EditorToggleShowLineNumbers = "<yon Toggle line numbers"
nnoremap <yon :action EditorToggleShowLineNumbers<CR>

let g:WhichKeyDesc_Toggles_RelativeLineNumbers = "<yor Toggle relative line numbers"
nnoremap <yor :set relativenumber!<CR>

let g:WhichKeyDesc_EditorToggleShowWhitespaces = "<yow Toggle show whitespaces"
nnoremap <yow :action EditorToggleShowWhitespaces<CR>

let g:WhichKeyDesc_EditorToggleShowGutterIcons = "<yog Toggle gutter icons"
nnoremap <yog :action EditorToggleShowGutterIcons<CR>

let g:WhichKeyDesc_TogglePowerSave = "<yop Toggle power save"
nnoremap <yop :action TogglePowerSave<CR>
